---
title: 实验环境搭建
date: 2021-10-11 17:30:57
tags:
categories:
- 环境
---

# 导读

在之前我们了解了gcc和nasm，我们即将进入os开发，首先我们准备一下实验环境。

# mac下安装 virtBox虚拟机
![ubuntu ubuntu-16.04.6 32 位下载](http://iso.mirrors.ustc.edu.cn/ubuntu-releases/16.04/ubuntu-16.04.6-desktop-i386.iso)
![VirtualBox 6.1 虚拟机软件 和扩展包](https://download.virtualbox.org/virtualbox/6.1.16/)

![](20211011193446)
需要下载两个，第一为扩展包，第二个为虚拟机软件
![Virtualbox for Mac 的使用教程](https://www.jianshu.com/p/d10e3ce34ba5) -->

1. 安装 VirtualBox 软件 
2. 安装增强软件
3. 在VirtualBox安装ubuntu
   1. 点击“新建”
   2. ![](20211011193830.jpg)
   3. 然后默认，点击下一步 
   4. 到这个界面
      1. ![](20211011193950.jpg)
   5. 点击设置-系统-处理器-开启FAG/NX
   6. 点击设置-存储-控制器-没有盘片-分配光驱-选择一个虚拟光盘文件
      1. ![](20211011194338.jpg)
   7. 启动,选择第三种分离启动

用哪个虚拟机并没多大关系，我用的vm
# ubunte 下安装Bochs
Bochs是一个硬件模拟器，是开发操作系统仿真软件。安装比较复杂, 按照教程安装即可

![在ubuntu 下安装bochs环境配置教程](https://zhuanlan.zhihu.com/p/35437842)

如何向虚拟机传送文件呢，我建议使用scp命令。将虚拟机设置为nat模式。获取虚拟机IP地址，设置[免密传输](https://blog.csdn.net/u010798968/article/details/74066392)。用scp传输文件即可。 


# mac 下安装Bochs
我没有使用虚拟你做实验，我是直接在主机安装的Bochs,省心。
[<真象还原> mac 搭建bochs 踩坑](https://juejin.cn/post/6967163808892583972)

安装的目录在 /Users/${user}/opt/bochs/ 

```
megs: 32

romimage: file=/Users/isam2016/opt/bochs/share/bochs/BIOS-bochs-latest
vgaromimage: file=/Users/isam2016/opt/bochs/share/bochs/VGABIOS-lgpl-latest

boot: disk  #从硬盘启动

log: /Users/isam2016/opt/bochs/bochs.out

mouse: enabled=0
keyboard: type=mf,keymap=/Users/isam2016/opt/bochs/share/bochs/keymaps/x11-pc-us.map

ata0: enabled=1,ioaddr1=0x1f0, ioaddr2=0x3f0, irq=14

ata0-master: type=disk, path="hd60M.img", mode=flat

```

# nasm -I include/ -o mbr.bin mbr.S && dd if=./mbr.bin of=/home/work/my_workspace/bochs/hd60M.img bs=512 count=1  conv=notrunc
nasm -I include/ -o mbr.bin mbr.S && dd if=./mbr.bin of=/Users/isam2016/opt/bochs/hd60M.img bs=512 count=1  conv=notrunc



;���������� 
;------------------------------------------------------------
SECTION MBR vstart=0x7c00         
   mov ax,cs      
   mov ds,ax
   mov es,ax
   mov ss,ax
   mov fs,ax
   mov sp,0x7c00

; ���� ����0x06�Ź��ܣ��Ͼ�ȫ���У����������
; -----------------------------------------------------------
;INT 0x10   ���ܺ�:0x06	   ��������:�Ͼ�����
;------------------------------------------------------
;���룺
;AH ���ܺ�= 0x06
;AL = �Ͼ�������(���Ϊ0,��ʾȫ��)
;BH = �Ͼ�������
;(CL,CH) = �������Ͻǵ�(X,Y)λ��
;(DL,DH) = �������½ǵ�(X,Y)λ��
;�޷���ֵ��
   mov     ax, 0x600
   mov     bx, 0x700
   mov     cx, 0           ; ���Ͻ�: (0, 0)
   mov     dx, 0x184f	   ; ���½�: (80,25),
			   ; VGA�ı�ģʽ��,һ��ֻ������80���ַ�,��25�С�
			   ; �±��0��ʼ,����0x18=24,0x4f=79
   int     0x10            ; int 0x10

;;;;;;;;;    ���������д����ǻ�ȡ���λ��    ;;;;;;;;;
;.get_cursor��ȡ��ǰ���λ��,�ڹ��λ�ô���ӡ�ַ�.
   mov ah, 3		; ����: 3���ӹ����ǻ�ȡ���λ��,��Ҫ����ah�Ĵ���
   mov bh, 0		; bh�Ĵ����洢���Ǵ���ȡ����ҳ��

   int 0x10		; ���: ch=��꿪ʼ��,cl=��������
			; dh=��������к�,dl=��������к�

;;;;;;;;;    ��ȡ���λ�ý���    ;;;;;;;;;;;;;;;;

;;;;;;;;;     ��ӡ�ַ���    ;;;;;;;;;;;
   ;������10h�ж�,��������ǵ���13���ӹ��ܴ�ӡ�ַ���
   mov ax, message 
   mov bp, ax		; es:bp Ϊ���׵�ַ, es��ʱͬcsһ�£�
			; ��ͷʱ�Ѿ�Ϊsreg��ʼ��

   ; ���λ��Ҫ�õ�dx�Ĵ���������,cx�еĹ��λ�ÿɺ���
   mov cx, 5		; cx Ϊ������,������������0���ַ�����
   mov ax, 0x1301	; �ӹ��ܺ�13����ʾ�ַ�������,Ҫ����ah�Ĵ���,
			; al����д�ַ���ʽ ah=01: ��ʾ�ַ���,�������ƶ�
   mov bx, 0x2		; bh�洢Ҫ��ʾ��ҳ��,�˴��ǵ�0ҳ,
			; bl�����ַ�����, ���Ժڵ�����(bl = 02h)
   int 0x10		; ִ��BIOS 0x10 ���ж�
;;;;;;;;;      �����ַ�������	 ;;;;;;;;;;;;;;;

   jmp $		; ʹ������ͣ�ڴ�

   message db "1 MBR"
   times 510-($-$$) db 0
   db 0x55,0xaa

https://blog.csdn.net/sinolover/article/details/93590622