---
title: HTTP协议
date: 2022-02-01
tags:
categories:
- 计算机网络
---

# 1 HTTP WEB 的基础
>[资料](https://segmentfault.com/a/1190000014134828)

*  MIME type： Web 服务器会为所有HTTP 对象数据附加一个MIME 类型中间由一个斜杠来划分

* URI: 统一资源标识符，我们通过他访问资源
    * URL: 统一资源定位符
    * URN: 统一资源名字（不常用）

* 方法
     * GET
     * PUT
     * POST
     * DELETE
     * POST
     * HEAD
  
* GET和POST 的区别

* 报文
    * 报文的种类
        * request message(请求报文)
        * response meassage(相应报文)
    * 组成格式
        * 起始行
        * 首部字段
        * 主体

* TCP/IP
>>HTTP 是个应用层协议。HTTP 无需操心网络通信的具体细节；它把联网的细节都
交给了通用、可靠的因特网传输协议TCP/IP。

* web的结构组件
    * 代理: 位于客户端和服务器之间的HTTP中间实体
    * 缓存（web cache）或代理缓存（proxy cache）： HTTP 的仓库，使常用页面的副本可以保存在离客户端更近的地方,是一种特殊的代理
    * 网关：连接其他应用程序的特殊Web 服务器。
    * Agent： 代理发起自动HTTP 请求的半智能Web 客户端。

# 2 URL与资源

## 2.1 报文流

* 报文向下流动： 不管请求报文还是相应报文，所有的报文都会向下流动![]()
* 报文的组成部分
    * 起始行
    * 首部: http首部字段向请求和响应报文添加了一些附加信息。由“名/值”对组成，`应用程序也可以随意发明自己的所用首部`，组成： name:（空格）key，如下图
      * 通用首部（出现在请求、响应报文）
      * 请求首部
      * 响应首部
      * 实体首部
      * 扩展首部
    * 主体
        


## 2.2 报文组成详细解释

我们知道报文的组成是由`起始行、首部字段、主体`组成的，但是报文的种类是不同的，我们依次看

基本报文语法 

* `method:` 方法 
* `version:` http版本  
* `status:` 状态码 
* `reason-phrase:` 原因短读 
* `header:` 首部

### 2.2.1 请求报文

![基本格式](https://isam2016hexo.oss-cn-hangzhou.aliyuncs.com/img/request.jpg)

#### 2.2.1.1 请求行

#### 2.2.1.2 请求首部
 
请求首部为请求报文添加了一些附加信息，由“名/值”对组成，每行一对，名和值之间使用冒号分隔。请求首部也有不同的含义

|   请求头   |                        说明                         |
| :--------: | :-------------------------------------------------: |
|    Host    | 接受请求的服务器地址，可以是IP:端口号，也可以是域名 |
| User-Agent |               发送请求的应用程序名称                |
| Connection |    指定与连接相关的属性，如Connection:Keep-Alive    |

#### 2.2.1.3 Accept首部

会使链接的两段都受益，客户端和得到他们想要的东西，拂去其不会浪费资源发送没用的东西。

|     请求头      |               说明               |
| :-------------: | :------------------------------: |
|     Accept      |          接受的媒体类型          |
| Accept-Charset  |   通知服务端可以发送的编码格式   |
| Accept-Encoding | 通知服务端可以发送的数据压缩格式 |
| Accept-Language |     通知服务端可以发送的语言     |

#### 2.2.1.4 条件请求首部

有时候希望客户端为请求加上某些限制，要求拂去其在对请求型芯响应之前，确保某个条件为真

|       请求头        |                            说明                            |
| :-----------------: | :--------------------------------------------------------: |
|       Expect        |           允许客户端列出请求所要求的服务器行为。           |
|      If-Match       |  如果实体标记与文档当前的实体标记相匹配，就获取这份文档。  |
|  If-Modified-Since  | 除非在某个指定的日期之后资源被修改过，否则就限制这个请求。 |
|    If-None-Match    | 如果提供的实体标记与当前文档的实体标记不相符，就获取文档。 |
|      If-Range       |             允许对文档的某个范围进行条件请求。             |
| If-Unmodified-Since | 除非在某个指定日期之后资源没有被修改过，否则限制这个请求。 |
|        Range        |       如果服务器支持范围请求，就请求资源的指定范围。       |


#### 2.2.1.5 安全请求首部

 http 本身可以进行询问/响应认证。这种响应要在客户端获取特定的资源之前。

|     首部      |                       描述                       |
| :-----------: | :----------------------------------------------: |
| Authorization | 包含了提供给服务器来对客户端进行自身认证的数据。 |
|    Cookie     |  它并不是真正的安全首部，但却是隐含了安全功能。  |
|    Cookie2    |         用来说明请求端支持的cookie版本。         |


#### 2.2.1.6 代理请求首部   


|        首部         |                                           描述                                            |
| :-----------------: | :---------------------------------------------------------------------------------------: |
|     Max-Forward     | 在通往源端服务器的路径上，将请求转发给其他代理或网管的最大次数----与 TRACE 方法一同使用。 |
| Proxy-Authorization |              Authorization 首部相同，但这个首部是在于代理进行认证时使用的。               |
|  Proxy-Connection   |                Connection 首部相同，但这个首部是在于代理建立连接时使用的。                |



#### 2.2.1.7  主体 [见下文]

### 2.2.2 响应报文

![基本格式](https://isam2016hexo.oss-cn-hangzhou.aliyuncs.com/img/response.jpg)

#### 2.2.2.1 响应行

#### 2.2.2.2 响应首部

|       请求头       |              说明              |
| :----------------: | :----------------------------: |
|        Age         |      推算资源创建经过时间      |
|        ETag        |         资源的匹配信息         |
|      Location      |    令客户端重定向至指定URI     |
| Proxy-Authenticate |  代理服务器对客户端的认证信息  |
|    Retry-After     |    对再次发起请求的时机要求    |
|    Server HTTP     |        服务器的安装信息        |
|   Accept-Ranges    |      是否接受字节范围请求      |
|        Vary        |    代理服务器缓存的管理信息    |
|  WWW-Authenticate  |    服务器对客户端的认证信息    |
|       Server       | 服务器应用程序软件的名称和版本 |


## 2.3 主体 [见下文]    

## 2.4 其他首部介绍

### 2.4.1 通用首部

通用请求比较少。一般是Date，Cache-Control或Connection。通用的缓存首部

|    请求头     |             说明             |
| :-----------: | :--------------------------: |
|     Date      |             时间             |
| Cache-Control |    用于随报文传送缓存指示    |
|    Pragma     | 另一种用于随报文传送缓存指示 |

### 2.4.2 实体首部 
 * *内容首部*

|      请求头      |             说明             |
| :--------------: | :--------------------------: |
| Content-Encoding |    实体主体适用的编码方式    |
| Content-Language |      实体主体的自然语言      |
|  Content-Length  | 实体主体的大小（单位：字节） |
| Content-Location |      替代对应资源的URI       |
|   Content-MD5    |      实体主体的报文摘要      |
|  Content-Range   |      实体主体的位置范围      |
|   Content-Type   |      实体主体的媒体类型      |

 * *实体缓存首部*

|    请求头     |          说明          |
| :-----------: | :--------------------: |
|     ETag      |  与实体相关的实体标注  |
|    Expires    | 实体主体过期的日期时间 |
| Last-Modified | 资源的最后修改日期时间 |

在缓存章节我们重点介绍

### 2.4.3  自定义首部

上文提到过我们可以自定义首部，自定义首部可以让前台和后台进行特殊的通信，但是需要后台的一些配合。
我们前台定义了特殊的头部
```js
//client/index.js

let myHeaders = new Headers({
    'X-Custom-Info': "isam2016" // 自定的请求头
});
```

如果没有后台的支持会报错

![](https://isam2016hexo.oss-cn-hangzhou.aliyuncs.com/img/custom.png)

后台支持
```js
//设置跨域访问  
app.all('*', function(req, res, next) {
  res.header("Access-Control-Allow-Headers", "X-Custom-Info");
  next();
});
```

## 2.5 主体
>位于首部行之后

实体包含了Web客户端请求的对象。当Web服务器接收到Web客户端的请求报文后，对HTTP请求报文进行解析，并将Web客户端的请求的对象取出打包，通过HTTP响应报文将数据传回给Web客户端，如果出现错误则返回包含对应错误的错误代码和错误原因的HTTP响应报文。

![](https://isam2016hexo.oss-cn-hangzhou.aliyuncs.com/img/body.png)

###  2.5.1状态码

 [HTTP返回码中301与302的区别](https://blog.csdn.net/qmhball/article/details/7838989)

| 总体范围 | 已定义范围 |       类别 |
| -------- | :--------: | ---------: |
| 100~199  |  100~101   |       信息 |
| 200~299  |  200~206   |       成功 |
| 300~399  |  300~305   |     重定向 |
| 400~499  |  400~415   | 客户端错误 |
| 500~599  |  500~505   | 服务器错误 |
  
**我们重点关注的是3开头的状态码**

| 状态 | 原因短语           |                                         含　　义                                          |
| :--- | :----------------- | :---------------------------------------------------------------------------------------: |
| 300  | Multiple Choices   |           多重选择。链接列表。用户可以选择某链接到达目的地。最多允许五个地址。            |
| 301  | Moved Permanently  |          请求的URL已移走。响应中应该包含一个LocationURL，说明资源现在所处的位置           |
| 302  | Found              | 与状态码301 类但这里的移除是临时的。客户端应该用Location 首部给出的URL 对资源进行临时定位 |
| 303  | See Other          |        告诉客户端应该用另一个URL 获取资源。这个新的URL 位于响应报文的Location 首部        |
| 304  | Not Modified       |       客户端可以通过它们所包含的请求首部发起条件请求。这个代码说明资源未发生过变化        |
| 305  | Use Proxy          |                 必须通过代理访问资源，代理的位置是在Location首部中给出的                  |
| 307  | Temporary Redirect |         和状态码301 类似。但客户端应该用Location 首部给出的URL 对资源进行临时定位         |

* 永久搬离的资源

    资源可能被移动到新的位置，或者被重新命名，有了一个新的URL.web服务器可以告诉客户端资源已经被重新命名了。这样客户端就可以从新的地址获取资源之前，更新数钱之类的信息了。状态码301就是这个作用

* 临时搬离资源

    如果资源被临时移走或重命名, 服务器可能希望将客户端重定向到新的位置上去。但由于重命名是临时的，所以服务器希望客户端将来还可以回去使用老的URL,不要对书签进行更新。状态码301 和 307

* URL增强

    服务器通常用重定向来重写URL，往往用于嵌入上下文。当请求到达时，服务器会生成一个新的包含了嵌入式状态信息的URL，并将用户重定向到这个新的URL上去。客户端会跟随这个重定向信息，重新发起请求，但这次的请求会包含完整的、经过状态增强的URL。这是在事务间维护状态的一种有效方式。状态码"303 See Other"和"307 Temporary Redirect"用于此类重定向。

* 负载均衡 
    
    如果一个超载的服务器收到一条请求，服务器可以将客户端重定向到一个负载不太重的服务器上去。状态码"303 See Other"和"307 Temporary Redirect"可用于此类重定向。

* 服务器关联
 
    Web服务器上可能会有某些用户的本地信息；服务器可以将客户端重定向到包含了那个客户端信息的服务器上去。状态码"303 See Other"和"307 Temporary Redirect"可用于此类重定向。

* 规范目录名称

    客户端请求的URI是一个不带尾部斜线的目录名时，大多数Web服务器都会将客户端重定向到一个加了斜线的URI上，这样相对链接就可以正常工作了。



# https 

>https的ssl 加密是在传输层实现的

## http和https的基本概念

http: 超文本传输协议，是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。

https: 是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。

https协议的主要作用是：建立一个信息安全通道，来确保数组的传输，确保网站的真实性。

## http和https的区别？

http传输的数据都是未加密的，也就是明文的，网景公司设置了SSL协议来对http协议传输的数据进行加密处理，简单来说https协议是由http和ssl协议构建的可进行加密传输和身份认证的网络协议，比http协议的安全性更高。

主要的区别如下：

* Https协议需要ca证书，费用较高。
* http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。
* 使用不同的链接方式，端口也不同，一般而言，http协议的端口为80，https的端口为443
* http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

## https协议的工作原理

客户端在使用HTTPS方式与Web服务器通信时有以下几个步骤，如图所示。

* 客户使用https url访问服务器，则要求web 服务器建立ssl链接。
* web服务器接收到客户端的请求之后，会将网站的证书（证书中包含了公钥），返回或者说传输给客户端。
* 客户端和web服务器端开始协商SSL链接的安全等级，也就是加密等级。
* 客户端浏览器通过双方协商一致的安全等级，建立会话密钥，然后通过网站的公钥来加密会话密钥，并传送给网站。
* web服务器通过自己的私钥解密出会话密钥。
* web服务器通过会话密钥加密与客户端之间的通信。

## https协议的优点

* 使用HTTPS协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；
* HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。
* HTTPS是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。
* 谷歌曾在2014年8月份调整搜索引擎算法，并称“比起同等HTTP网站，采用HTTPS加密的网站在搜索结果中的排名将会更高”。

## https协议的缺点

* https握手阶段比较费时，会使页面加载时间延长50%，增加10%~20%的耗电。
* https缓存不如http高效，会增加数据开销。
* SSL证书也需要钱，功能越强大的证书费用越高。
* SSL证书需要绑定IP，不能再同一个ip上绑定多个域名，ipv4资源支持不了这种消耗。

<!-- ## TODO: https 加密原理（对称加密，非对称加密） -->